machine:

  timezone:
    Europe/Paris

  node:
    version: 6.7.0

  services:
    - docker

dependencies:

  pre:
    - sudo service mysql stop
    - sudo service postgresql stop

  cache_directories:
    - node_modules

  override:
    - set -e
    - sh ./docker-scripts/ci-bootstrap-container.sh "mysql" "deve_mysql" "-p 3306:3306 -e MYSQL_ROOT_PASSWORD=none" "library/mysql:5"
    - sh ./docker-scripts/wait-for-it.sh -h localhost -p 3306
    - sh ./docker-scripts/ci-bootstrap-container.sh "rabbitmq" "deve_rabbitmq" "-p 5672:5672 -p 15672:15672 -e RABBITMQ_PASS=none" "tutum/rabbitmq:latest"
    - sh ./docker-scripts/wait-for-it.sh -h localhost -p 15672
    - sh ./docker-scripts/ci-bootstrap-container.sh "rethinkdb" "deve_rethinkdb" "-p 29015:29015 -p 28015:28015 -p 8080:8080" "library/rethinkdb"
    - sh ./docker-scripts/wait-for-it.sh -h localhost -p 8080

test:

  override:
    - npm install
    - npm prune
    - npm test
