<!DOCTYPE html>
<html>
  <head>
    <title>API GATEWAY - REALTIME</title>
  </head>
  <body>
    
    <individuals-list> </individuals-list>
    
    <!-- js external -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/async/1.5.0/async.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/riot/2.3.1/riot+compiler.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.7/socket.io.min.js"></script>
    
    <!-- riot tags -->
    <script src="components/individuals-list.tag" type="riot/tag"></script>
    
    <!-- js internal -->
    <script src="js/facade.js"></script>
		<script src="js/app.js"></script>
		
    <script>

  		$(function() {
  		  
  			var socket = io.connect('https://gperreymond-abibao.c9.io');
  			
  			socket.on("individualsChanged", function(data) {
  			  console.log('individualsChanged', data);
          if (data.length) {
            facade.individuals = data;
            return facade.tags['individuals-list'].update();
          }
          if (!data.old_val) {
            facade.individuals.push(data.new_val);
            return facade.tags['individuals-list'].update();
          }
          for (var s in facade.individuals)
            if (facade.individuals[s].id == data.old_val.id) {
              _.pull(facade.individuals, facade.individuals[s]);
              facade.tags['individuals-list'].update();
            }
        });
  			
  			socket.on('individualCreated', function(item) {
  				console.log('individualCreated', item);
  				facade.tags['individuals-list'].update();
  			});
  			
  		});
  		
  	</script>
  </body>
</html>